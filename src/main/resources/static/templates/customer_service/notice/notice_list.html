<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>공지사항 목록</title>

    <link rel="stylesheet" href="../css/common.css">
    <style>
        /* 간단한 스타일 추가 */
        .cs_sub_nav ul li.on a {
            font-weight: bold;
            color: #333;
        }
        .cs_sub_nav ul li a {
            cursor: pointer;
        }
        /* 페이지네이션 스타일 */
        .prev-page, .next-page {
            border: none;
            width: 50px;
            height: 30px;
            cursor: pointer;
            margin: 0 10px;
        }
    </style>
</head>
<body>

    <div id="header"></div>

    <div id="content" class="cs_notice_list_wrap">
        <h1>NOTICE</h1>
        <div class="cs_sub_nav">
            <ul>
                <li class="on"><a href="#" data-category="전체">전체</a></li>
                <li><a href="#" data-category="고객서비스">고객서비스</a></li>
                <li><a href="#" data-category="안전거래">안전거래</a></li>
                <li><a href="#" data-category="위해상품">위해상품</a></li>
                <li><a href="#" data-category="이벤트당첨">이벤트당첨</a></li>
            </ul>
        </div>
        <div class="cs_list_table">
            <p class="total_count">총 <span class="count">256</span>건</p>
            <table>
                <colgroup>
                    <col style="width: 15%;">
                    <col style="width: auto;">
                    <col style="width: 20%;">
                </colgroup>
                <thead>
                    <tr>
                        <th>분류</th>
                        <th>제목</th>
                        <th>등록일</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- 공지사항 리스트 동적 생성 -->
                </tbody>
            </table>
        </div>
         <!-- 페이지네이션 -->
        <div style=" height: 100px; margin-top:40px; display: flex; justify-content: center;">
            <form action="" method="" style="">
                <div style="display: flex;">
                    <div style="">
                        <input type="button" class="prev-page" value="< 이전" style="border:1px solid #ddd;">
                    </div>
                    <div style="">
                        <input type="button" value="1" style="border:1px solid #333; background-color: #333; color: white; height: 30px; width: 30px; margin-right:2px; line-height:1;">
                        <input type="button" value="2" style="cursor: pointer; border:1px solid #ddd; color: #555; height: 30px; width: 30px; margin-right:2px; line-height:1;">
                        <input type="button" value="3" style="cursor: pointer; border:1px solid #ddd; color: #555; height: 30px; width: 30px; line-height:1;">
                    </div>
                    <div>
                        <input type="button" class="next-page" value="다음 >" style="border:1px solid #ddd;">
                    </div>
                </div>
            </form>
            
        </div>
    </div>
<div id="footer"></div>
<script>
        // header/footer 불러오기
        fetch("../../main/header.html")
          .then(res => res.text())
          .then(data => {
            document.getElementById("header").innerHTML = data;
            // 스크립트 실행 강제 (기존 코드 유지)
            const scripts = document.getElementById("header").querySelectorAll("script");
            scripts.forEach(oldScript => {
              const newScript = document.createElement("script");
              if (oldScript.src) {
                newScript.src = oldScript.src;
              } else {
                newScript.textContent = oldScript.textContent;
              }
              document.body.appendChild(newScript);
            });
          });
        fetch("../../main/footer.html")
          .then(res => res.text())
          .then(data => {
            document.getElementById("footer").innerHTML = data;
          });

        // 샘플 데이터: 실제 데이터는 서버 API로 대체 가능
        const notices = [
            { id:1, category: "안내", title: "해외결제사 정기점검주의", date: "22.10.31", detailCategory: "전체" },
            { id:2, category: "고객서비스", title: "고객센터 운영시간 변경", date: "22.11.01", detailCategory: "고객서비스" },
            { id:3, category: "안전거래", title: "안전거래 정책 안내", date: "22.11.02", detailCategory: "안전거래" },
            { id:4, category: "위해상품", title: "리콜 공지사항", date: "22.11.03", detailCategory: "위해상품" },
            { id:5, category: "이벤트당첨", title: "이벤트 당첨자 발표", date: "22.11.04", detailCategory: "이벤트당첨" },
            { id:6, category: "안내", title: "시스템 점검 안내", date: "22.11.05", detailCategory: "전체" },
            { id:7, category: "고객서비스", title: "서비스 개선 안내", date: "22.11.06", detailCategory: "고객서비스" },
            // 더 추가 가능
        ];

        const itemsPerPage = 5;
        let currentPage = 1;
        let currentCategory = "전체";

        const tbody = document.querySelector('.cs_list_table tbody');
        const countSpan = document.querySelector('.count');
        const pageNumbersContainer = document.getElementById('page-numbers');

        // 필터링된 공지사항 데이터 가져오기
        function getFilteredNotices() {
            if (currentCategory === "전체") return notices;
            return notices.filter(n => n.detailCategory === currentCategory);
        }

        // 공지사항 리스트 렌더링
        function renderList(page = 1) {
            currentPage = page;
            const filteredNotices = getFilteredNotices();

            const totalItems = filteredNotices.length;
            countSpan.textContent = totalItems;

            tbody.innerHTML = "";

            const start = (page - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageItems = filteredNotices.slice(start, end);

            pageItems.forEach(item => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>[${item.category}]</td>
                    <td class="title"><a href="notice_view.html?id=${item.id}&category=${encodeURIComponent(currentCategory)}">${item.title}</a></td>
                    <td>${item.date}</td>
                `;
                tbody.appendChild(tr);
            });

            renderPagination(totalItems, page);
        }

        // 페이지네이션 렌더링
        function renderPagination(totalItems, page) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            pageNumbersContainer.innerHTML = "";

            for(let i = 1; i <= totalPages; i++) {
                const btn = document.createElement('input');
                btn.type = 'button';
                btn.value = i;
                btn.style.marginRight = '5px';
                btn.style.height = '30px';
                btn.style.width = '30px';
                btn.style.lineHeight = '1';
                btn.style.border = '1px solid #ddd';
                btn.style.cursor = 'pointer';

                if (i === page) {
                    btn.style.backgroundColor = '#333';
                    btn.style.color = 'white';
                    btn.style.borderColor = '#333';
                    btn.style.cursor = 'default';
                }

                btn.addEventListener('click', () => {
                    if (currentPage !== i) {
                        renderList(i);
                    }
                });

                pageNumbersContainer.appendChild(btn);
            }

            // 이전/다음 버튼 상태 토글
            document.querySelector('.prev-page').disabled = (page <= 1);
            document.querySelector('.next-page').disabled = (page >= totalPages);
        }

        // 카테고리 클릭 이벤트
        document.querySelectorAll('.cs_sub_nav ul li a').forEach(a => {
            a.addEventListener('click', (e) => {
                e.preventDefault();
                const selectedCategory = e.target.getAttribute('data-category');
                if (selectedCategory === currentCategory) return;

                currentCategory = selectedCategory;
                currentPage = 1;

                // li.on 클래스 변경
                document.querySelectorAll('.cs_sub_nav ul li').forEach(li => li.classList.remove('on'));
                e.target.parentElement.classList.add('on');

                renderList(currentPage);
            });
        });

        // 이전 버튼 클릭
        document.querySelector('.prev-page').addEventListener('click', () => {
            if (currentPage > 1) {
                renderList(currentPage - 1);
            }
        });

        // 다음 버튼 클릭
        document.querySelector('.next-page').addEventListener('click', () => {
            const filteredNotices = getFilteredNotices();
            const totalPages = Math.ceil(filteredNotices.length / itemsPerPage);
            if (currentPage < totalPages) {
                renderList(currentPage + 1);
            }
        });

        // 초기 렌더링
        document.addEventListener('DOMContentLoaded', () => {
            renderList(1);
        });
    </script>


</body>
</html>